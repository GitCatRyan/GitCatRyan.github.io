---
layout: post
title: EOS白皮书重点概念重温（上）
date: 2018-07-03 21:22:24.000000000 +08:00
---

无论是EOS持有者，还是开发人员，都有必要对EOS白皮书中的重点概念透彻掌握。

万事开头难，概念第一步。

在开始开发学习之前，我会用两篇文章的篇幅把EOS白皮书（V2）中的重点概念重新梳理，同时也作为复习资料。

#1、EOS.IO是什么

EOS.IO软件采用了一种全新设计的区块链架构，实现了去中心化应用的横向和纵向扩展。具体方法为构建一个类操作系统的架构，开发者可以在其中搭建应用程序。

EOS.IO软件提供跨CPU跨集群的账户系统、身份验证、数据库、异步通信，并且支持应用程序间的调度。用以实现上述特性的技术是一种特定的区块链架构，在受管控的区块链环境中，可扩展至每秒处理百万级交易，消除用户手续费，并且允许快速和轻松地部署和维护去中心化应用。

一句话概括：EOS是一条公链，性能极强，对用户免费，支持多种功能。开发者可在EOS上开发各类DApp，EOS为这些DApp提供底层环境支撑。

#2、EOS的共识算法

**算法运行原理**

EOS.IO软件采用DPOS算法。在目前已知的去中心化共识算法中，只有该算法经证明可以满足区块链上应用程序的性能要求。根据这种算法，EOS区块链上所有代币持有者可以都通过一个持续的投票系统选择区块生产者。想参与区块生产，只要能说服代币持有人给自己投票，最终（得票最高的那些节点）被选为区块生产者（BP）。

EOS.IO软件能够精确地每0.5秒产生一个区块，并且在任一时间仅有一个生产者获权生产区块。如果在预定时间内没有区块生成，则跳过该块。相应的，当跳过一个或多个块时，区块链中会存在一个大于等于0.5秒的时间间隔。

使用EOS.IO软件，每一轮产生126个区块（共21个区块生产者，每一轮都有一个特定的生产者负责产生6个块，即一轮的时间为63秒）。在每轮开始时，根据代币持有者的投票选出21个不同的区块生产者。获选的生产者的生产顺序由15个或更多生产者一致同意决定。

如果一个生产者错过了一个块，并且在过去24小时均未产生任何块，则会被从生产者的名单中剔除，直至他通知区块链表明他打算再次开始生产区块。这种方式可以排除不可靠的生产者来最小化错过的区块数量，从而确保网络的顺畅运行。

**分叉处理**

正常情况下，DPOS区块链不会产生任何分叉，因为生产者生产区块的方式是合作而非竞争。如果出现分叉，那么共识的处理方式是自动切换到最长的链上。

其工作原理是，`一个区块链的分叉上新区块的添加速度与在这个分叉上达成共识的生产者的多寡直接相关`。换言之，生产者数量多的分叉，其增长速度要比生产者较少的分叉的增长速度更快，这是因为生产者数量多的分叉错过的区块数往往会更少。

此外，任何区块生产者都不应该在同一时刻在两个分叉上竞争出块。如果有块生产者被发现这么做，可能会被投票出局。这种双重生产会留下密码学证据，因此识别并自动清除这类区块生产者是可行的。

**为什么要添加拜占庭容错（BFT）？**

添加了拜占庭容错机制的DPOS算法`需要所有生产者签名所有区块，但禁止同一个生产者签名两个时间戳或高度相同的区块`。一个区块一旦被15个生产者签名，那么这个区块就可以被视为不可逆了。

任何生产者一旦签名两个相同时间戳或相同区块高度的区块，这种不诚信行为就会留下密码学证据。在这一模型下，不可逆的共识将在1秒内达成。

**EOS如何防双花？**

EOS.IO软件要求每一笔交易必须包括最近的一个区块头的部分哈希值。这个哈希值有两个目的：

1. 防止一个交易在另一个未包含该交易的分叉上被`重新广播`（双花）。
2. 通知整个网络，某个特定用户和他的权益存在于某个特定的分叉上。

如此一来，伪造假冒链将变得非常困难，因为伪造者无法将合法链中的交易迁移到假冒链上。

#3、账户

`账户`是用户使用EOS必须拥有的身份，就像去银行存取款必须先开户一样。EOS中的所有操作、权限管理、密钥管理等，都要通过账户来进行。

EOS.IO软件规定所有的账户都由一个唯一名称来标识，名称的最大长度为12个字符，该名称由帐户的创建者指定。

帐户创建者必须使用EOS代币预留RAM用来存储新帐户，直至新帐户质押自己的代币来预留自己的RAM。

#4、操作

每个帐户可以发送结构化的`操作`（Actions）到其他帐户，并且可以定义程序代码来处理收到后的操作。EOS.IO软件为每个帐户提供自己的私有数据库，只能由该账户的操作处理程序（Action Handler）访问。操作处理程序还可以发送操作到其他账户。操作和自动化的操作处理程序的结合合是EOS.IO定义智能合约的方式。

为支持并发执行操作，每个账户可以在其数据库内定义任意多个作用域。区块生产者通过这种方式安排事务，使得事务执行时对作用域的内存访问没有冲突，因此事务可以并发执行。

#5、基于角色的权限管理

`权限管理`包括确认某项操作是否被正确授权。EOS.IO软件提供了一个`声明式`权限管理系统，可以对帐户进行细粒度、高级别的控制，以确定谁在何时可以做什么。

每个帐户都可以通过其他帐户和私钥的组合来控制。这就创建了一个分层的权限结构，真实反映了现实中权限的组织方式，并使得多用户的账户控制比以往更容易。

多用户控制对提升安全性的作用是最大的。如果使用得当，会极大降低黑客攻击而造成的盗窃风险（注：类似于QQ号被盗后的申诉）。

EOS.IO软件允许帐户定义什么样的账户和密钥的组合可以把特定的操作发送到另一个账户。例如，可以使用一个密钥访问用户的社交媒体帐户，另一个密钥用于访问交易所。甚至可以授权其他帐户来代表本账户进行操作，而无需为其他账户分配密钥。

**权限映射**

EOS.IO软件允许每个帐户定义从合约/操作或其他账户的合约到其自己的命名的权限级别之间的映射。

例如，账户持有人可将其社交媒体应用程序映射到账户所有者的"朋友"权限组。通过此映射，该账户的任何朋友都可以作为账户所有者在社交媒体发布信息（注：类似于微信公众号可以授权给多人同时进行管理）。

尽管这些朋友可以作为帐户所有者发布信息，但他们仍然会使用自己的密钥来签名。这就意味着，哪些朋友以何种方式使用了该帐户，始终是可以确定的。

**权限是如何评估的？**

EOS.IO为每个账户提供两个默认权限：一个是`owner`，权限最高，可以执行任何操作；另一个是`active`，除了更改owner权限以外，可以执行所有操作。其他的权限都是从active权限派生出来的。

当从账户 @alice发送类型为`Action`的操作到 @bob 时，EOS.IO软件将首先检查@alice是否为 @bob.groupa.subgroup.Action定义了权限映射。如果没有发现任何结果，那么将会检查 @bob.groupa.subgroup，然后检查 @bob.groupa，最后检查 @bob。如果没有找到进一步的匹配，则假定映射的命名权限组是 @alice.active。

一旦确定了映射的命名权限，则使用多签名阈值来验证签名，并获取命名权限相关联的权限。如果失败，那么它会遍历父类权限，最后遍历owner的权限，即 @alice.owner。

**并发地进行权限评估**

权限评估过程是`只读`的，并且，对权限的更新交易直到被打包进区块后才会生效。

这意味着：

> 1.一切交易的所有密钥和权限评估都可以并发执行;
2.快速权限验证是可行的，而且不需要启动昂贵的应用程序逻辑;
3.交易权限可以在接收到待处理的交易时进行评估，而在待处理的交易被处理时无需重新评估。

从整体来看，权限验证占交易验证中所需计算的很大一部分。让权限验证过程只读，并且可并发执行，可以显著提升性能。

#6、操作的延迟性

这一点十分关键，意味着EOS对容错性的考虑。在比特币和以太坊上，对容错性的考虑是不足的，用户没有犯错的机会。

EOS.IO软件使得开发者可以指定某些操作 (Actions) 在记录到一个区块后必须至少等待一小段时间后才被应用。在此期间，操作可以取消。

当一个操作广播后，用户可以通过电子邮件或短信来接收其通知。如果他们没有给这个操作授权，那就可以使用账户恢复流程来恢复账户并撤销操作。

上述所需的操作确认延迟取决于操作的敏感程度。支付咖啡钱时可以没有任何延迟，在几秒钟内就达到不可逆，而购房时可能就需要72小时的结算期。转让整个帐户到新的控制权可能需要长达30天的时间。确切的延迟时间是由应用开发者和用户共同决定的。

#7、密钥被盗后的恢复

EOS.IO软件为用户提供了一种在密钥被盗后恢复帐户控制权的方法。（多么贴心！！！）

帐户所有者 (owner) 可以通过过去30天内处于活跃状态的任何owner密钥，以及来自其指定的帐户恢复合作伙伴的批准来重置其帐户的owner密钥。没有帐户所有者的帮助，帐户恢复合作伙伴无法单独重置帐户的控制权。

黑客尝试完成恢复流程是没有意义的，因为他们已经"控制"了帐户。此外，如果他们万一真要走这个流程，恢复伙伴也会要求身份识别和多重认证（电话和电子邮件）。这会让黑客的身份受到怀疑，或让他在该流程中一无所获。

该流程与简单的多重签名协议很不一样。多重签名交易中，另一方会成为每笔交易的参与者。相比之下，在恢复流程中，合作伙伴只是参与了恢复流程，无权干预日常交易。这大大降低了所有相关人员的操作成本和法律责任。