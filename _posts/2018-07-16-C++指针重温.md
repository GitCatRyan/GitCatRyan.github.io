---
layout: post
title: C++指针重温
date: 2018-07-16 20:10:24.000000000 +08:00
---

距离大学期间学习的C语言和C++已经六七年时间了，后来一直没有太多实践，也就渐渐淡忘。因为EOS开发，现在重拾C++。第一篇就先从指针开始，这也是作为一个C++程序员必须透彻理解的部分。

**为什么要学习指针**

通过指针，可以简化一些C++编程任务的执行。还有一些任务，比如动态内存分配等都必须依靠依靠执行。

**指针是什么**

指针是一个变量，其值为另一个变量的地址，即，内存位置的直接地址。

定义指针：

    int *ip;          //整型指针
    double *dp;       //double型指针
    float *fp;        //浮点型指针
    char *ch;         //字符型指针

指针的类型，实际上是该指针指向的变量的类型。无论什么类型的指针，它的值都是一样的，都是一个代表内存地址的长的十六进制数。

**常用的指针操作**

关于指针，其实就3个最核心的操作：定义指针、给指针赋值、访问指针指向的变量的值。下面给出例子：

	#include <iostream>

	using namespace std;

	int main()
	{
		int var = 20;	//声明变量
		int *p;			//声明指针

		p = &var;		//给指针赋值

		//输出变量的值
		cout<<"value of var is:"<<var<<endl;

		//输出指针的值
		cout<<"value of p is:"<<p<<endl;

		//输出指针指向的变量的值
		cout<<"value of *p is:"<<*p<<endl;

		return 0;
	}

除了最基本的操作外，还有一些重要概念是需要了解的，下面一一介绍。

**C++ Null指针**

在声明指针变量时，如果暂时没有确切的地址可以赋值，为指针变量赋一个Null值是一个良好的编程习惯。赋为Null值的指针被称为空指针。

	int *p = NULL;

此时，p本身的值是0。内存地址0有特别重要的意义，它表明该指针不指向一个可访问的内存位置。

如需检查一个指针是否为空，可以用if语句：
	
	if(p)	//如果p非空，则条件满足

如果所有未使用的指针都被赋予空值，同时避免使用空指针，就可以防止误用一个未初始化的指针。很多时候，未初始化的变量存有一些垃圾值，导致程序难以调试。

**指针的算术运算**

由于指针本身是一个用十六进制数表示的地址，所以指针本身可以执行算术运算，支持++、--、+、-、比较等操作。

**指针与数组的关系**

一个数组的数组名，就是指向该数组第一个元素的指针。

事实上，指针和数组在很多情况下是可以互换的。例如，一个指向数组开头的指针，可以通过使用指针的算术运算或数组索引来访问数组。

	#include <iostream>

	using namespace std;

	const int MAX = 3;
 
	int main ()
	{
 	  int  var[MAX] = {10, 100, 200};
   	  int  *ptr;
 
   	  // 指针中的数组地址
      ptr = var;
      for (int i = 0; i < MAX; i++)
      {
    	  cout << "var[" << i << "]的内存地址为 ";
   	      cout << ptr << endl;
 
    	  cout << "var[" << i << "] 的值为 ";
    	  cout << *ptr << endl;
 
     	 // 移动到下一个位置
     	 ptr++;
      }
   	  return 0;
	}

但在上面的程序中，不能直接对var进行算术运算，因为var是一个指向数组开头的常量。

**指针数组**

顾名思义，就是用来存储指针的数组，数组的每个元素都是指针。

    int  var[MAX] = {10, 100, 200};
    int *ptr[MAX];
 
    for (int i = 0; i < MAX; i++)
    {
       ptr[i] = &var[i]; // 赋值为整数的地址
    }

**指向指针的指针**

这是一种多级间接寻址方式，也是一个指针链。先通过第一个指针找到第二个指针的位置，然后取出里面的值，再根据第二个指针的值，找到变量的位置。

一个int型的指向指针的指针定义如下：

	int **var;

**传递指针给函数**

c++允许指针作为参数传递给函数，只需简单声明函数参数为指针类型即可。能接受指针作为参数的函数，也可以接受数组作为参数。

	double getAverage(int *arr, int size);	//函数声明

	int main()
	{
		int balance[3] = {1,2,3};
		double avg;

		avg = getAverage(balance,3);

		cout<<avg<<endl;

		return 0;
	}

前面我们说过，数组名本身就是指针，所以这个例子说明了函数如何接受指针作为参数。

**从函数返回指针**

同样，C++允许从函数返回指针，该函数必须是指针类型的。比如：

	int *function()
	{
		...
	}