---
layout: post
title: EOS白皮书重点概念重温（下）
date: 2018-07-05 21:22:24.000000000 +08:00
---

**八、应用并行**

EOS.IO 软件在 2018 年 6 月的发行版将会是单线程的，但是它会包含将来多线程、并行执行所需的数据结构。

在基于 EOS.IO 软件的区块链中，一旦启用并行操作，区块生产者的工作就是将操作 (Action) 投递到独立的分片 (shard) 中，以便可以进行并行评估。区块生产者的产出是将被确定性地执行的计划表，但是生成计划表的过程不需要是确定性的。这意味着区块生产者可以利用并行算法来调度交易。

**通信延迟最小化**

延迟时间是指一个帐户向另一个帐户发送操作并接收响应所需的时间。我们的目标是使两个账户能够在一个区块内来回交换操作，而不必为每次操作都等待 0.5 秒。为了实现这一点，EOS.IO 软件将每个区块分成多个循环 (Cycle)，每个循环又被分成多个分片，每个分片包含一组交易。每笔交易都包含一组要投递的操作。这个结构可以被可视化为一棵树，其中不同层交替地按顺序及并行地处理。

**自主最优调度**

EOS.IO 软件不能强迫区块生产者投递任何操作给任何其他帐户。每个区块生产者都需要对处理交易所需的计算复杂度和时间做出主观测量。

在一个基于 EOS.IO 软件的区块链里，在网络层面上，所有交易会根据执行的 WASM 指令数来计算带宽成本。但是使用 EOS.IO 软件的每个区块生产者都可能会使用自己的算法和标准来计算资源的使用情况。当区块生产者判定某个交易或账户会消耗过多的计算能力时，在生产自己的区块时他们会直接拒绝这个交易；但是如果其他区块生产者都认为这个交易有效，他们还是会处理该交易。

**上下文无关的操作**

上下文无关的操作是指包含仅依赖交易数据，而不依赖区块链状态的计算。比如说，签名验证这种计算，只需要交易数据和签名以确定签署交易公钥。在区块链必须执行的单个计算中，这是最昂贵的一种，然而由于这种计算是上下文无关的，所以它可以被并行执行。

通过支持上下文无关的操作，Sharding，Raiden，Plasma，State Channels 等扩容技术变得更加可并行和实用。这项技术的开发可以实现高效的区块链间通信和潜在的无限可扩展性。

**九、治理**

个人觉得EOS引入了治理概念，是BM的神来之笔。想寄希望于code is law的极客们可能终究会发现此路不通。人类社会无法用一个完美固定的体系来规定，只有与治理相融合，才能达到更好的效果。

治理是指人们在社区中的一系列管理流程，借此人们可以：
1. 就那些软件算法无法完全捕获的集体行动的主观问题达成共识
2. 执行他们做好的决定
3. 通过章程修正案来修改治理规则

基于 EOS.IO 程序的区块链所认可的是权利来源于将那些权利委托给区块生产者的代币持有者。区块生产者被赋予了受限且经过验证的权限，他们可以利用这些权限，完成账户冻结，更新有缺陷的程序，或者提议对基本协议的硬分叉更改。

区块生产者选举是集成于 EOS.IO 程序之中的。在对区块链做任何更改之前，这些改动都必须经过这些区块生产者的批准。如果块生产者拒绝执行代币持有者所希望的改变，那么块生产者可能会被投票出局。如果区块生产者在未经代币持有者允许的情况下做了更改，那么所有的其他非生产性全节点验证器（交易所等）则能够拒绝掉这些更改。

**冻结账户**

有时，智能合约的行为会发生异常或者变得不可预测，不再按预期执行；或有时，应用程序或账户会发现某个行为会导致其过度消耗资源，当这些问题不可避免地发生时，区块生产者有权去纠正这些问题。

区块链上的所有区块生产者都有权去确定哪些交易会被包含进块中，这使得他们有能力冻结账户。只要 EOS.IO 软件中 21 个活跃生产者中的 15 个投票达成一致，即可授权冻结账户。如果生产者滥用该权力，那么他们则会被投票出局，被冻结的账户也将得以解冻。

**更改账户代码**

当所有其他办法都失效且有一个"无法停止的程序"以不可预知的方式在运行时，使用 EOS.IO 软件允许区块生产者在不使用硬分叉的情况下替换这些账户的代码。这种替换代码的的请求类似于冻结账户的过程，需要至少 15 个区块生产者投票通过。

**宪法**

EOS.IO 程序允许区块链建立点对点的服务条款，或是在签署该协议的用户之间绑定合约，我们称之为"宪法"。该宪法规定，用户之间不能完全由代码来规定执行的义务，而是应该通过建立管辖权和法律法规以及其他相互接受的规则来帮助解决出现的争议。网络上每笔交易的广播都必须包含章程的哈希来作为签名的一部分，从而明确地将签署人绑定到合约中。

该宪法还规定应考虑源代码协议的可读性。该功能用于明确区分漏洞和功能，同时引导社区界定哪些修复是合适的，哪些是不合适的。

**协议和宪法的升级**

协议的正规源代码以及章程规定，协议可以进行更新。EOS.IO 程序规定更新过程如下：
1. 区块生产者提议对章程作出修改，并获取到 15/21 的认可。
2. 区块生产者在连续的 30 天保持并拥有对新章程的 15/21 的认可。
3. 所有用户都必须表明接受新章程，并以此作为对未来交易处理的条件。
4. 区块生产者根据章程所发生的变化对源代码进行修改，并使用新章程的哈希将其提交至区块链。
5. 区块生产者在连续的 30 天保持并拥有对新代码的 15/21 的认可。
6. 对代码所做的更改在 7 天后生效，当源代码得到正式批准后，给予所有非生产完整节点 1 周的时间进行升级。
7. 所有未升级到新代码的节点会自动关闭。

**十、跨链通信**

EOS.IO 的设计能促进跨链通信，实现方式是简化生成操作存在证明和顺序证明。这些证明和围绕操作传递设计的应用架构一起，使得跨链通信的细节和验证工作对应用开发者不可见，开发者看到的只是更高层次的抽象。

**用于轻客户端验证的merkle证明**

如果客户端不需要处理全部交易的话，和其他区块链的结合将变得非常容易。毕竟类似交易所这样的客户端，它只关心资产的转入和转出。理想情况下，交易所的链可以用转账交易的轻量默克尔证明（来完成交易所业务），而不是完全信任某个区块生产者。每条链的区块生产者都希望和其他链同步的开销尽可能地小。

任何有不可逆区块头数据的用户在交易被区块记录后，都可以使用 EOS.IO 提供的轻量证明。轻量证明的哈希连接（hash-linked）结构表明，最多只要 1024 个字节，即可验证任何一笔交易的存在与否。

考虑到区块链中的区块的 id 和区块头都是可信的且不可逆的，因此证明某个区块被包含在某个区块链中也是可行的。这类证明最多只需 ceil(log2(N)) 次摘要计算即可完成，其中 N 为区块链中的区块个数。就 SHA256 这种摘要算法来说，你只需要 864 个字节就可以在一个有着 1 亿个区块的链上验证某个区块的存在。

使用合适的哈希连接（hash-linking）机制生产区块以启用上述证明，几乎不会带来什么额外开销，所以这种方式十分可行。

**隔离见证**

隔离见证（SegWit）是指一笔交易被打包进不可变更的区块链之后，这笔交易的签名就与交易无关了。一旦交易变为不可变更状态，签名数据就可以被舍弃，其他人仍然能获得区块链当前状态。考虑到签名数据容量占据了多数交易的很大部分，隔离见证将能大幅缩减磁盘占用和数据同步时间。